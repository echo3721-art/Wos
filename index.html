<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>W OS</title>
  <link rel="icon" href="ppplll.png" type="image/png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Orbitron:wght@500;600&display=swap" rel="stylesheet">
  
  <style>
    /* Global Styles */
    html, body {
        height: 100%;
        margin: 0;
        background-color: #111;
        background-image: url('gb.png');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        color: white;
        font-family: 'Space Grotesk', sans-serif;
        overflow: hidden; 
        user-select: none;
        transition: background-image 0.5s ease;
    }

    /* Welcome Screen */
    #welcome-screen {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        cursor: pointer;
        transition: opacity 1s ease-out;
    }

    #welcome-screen canvas {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 1999;
    }

    #welcome-content {
        position: relative;
        z-index: 2001;
        text-align: center;
    }

    .fade-out { opacity: 0; pointer-events: none; }

    .glow {
        font-size: 3em;
        font-family: 'Orbitron', sans-serif;
        color: #0ff;
        text-shadow: 0 0 10px #0ff, 0 0 20px #0ff;
        animation: welcomeGlow 2s ease-in-out infinite alternate;
    }

    @keyframes welcomeGlow {
        from { text-shadow: 0 0 10px #0ff; }
        to { text-shadow: 0 0 30px #0ff, 0 0 40px #0ff; }
    }

    /* Desktop Layout */
    #desktop {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        grid-auto-rows: 150px;
        padding: 40px;
        gap: 20px;
        height: calc(100vh - 40px);
        position: relative;
    }
    
    /* Icon Container */
    .app-icon {
        width: 120px;
        height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        position: relative;
        z-index: 10;
        transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        will-change: transform, left, top;
    }

    /* Icon Inner - contains floating effect */
    .app-icon-inner {
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(0, 255, 255, 0.15);
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 10px;
        box-sizing: border-box;
        animation: idleFloat 4s ease-in-out infinite;
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
    }

    @keyframes idleFloat {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
    }

    .icon-emoji {
        font-size: 40px;
        margin-bottom: 5px;
    }

    .app-label {
        font-size: 12px;
        font-weight: 600;
        text-align: center;
        color: #fff;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        pointer-events: none;
        word-wrap: break-word;
        max-width: 100%;
    }

    .app-icon:hover {
        z-index: 20;
        transform: scale(1.08);
    }

    .app-icon:hover .app-icon-inner {
        animation-play-state: paused;
        background: rgba(0, 255, 255, 0.1);
        border: 2px solid #0ff;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
    }

    .app-icon.dragging {
        cursor: grabbing;
        z-index: 1000;
    }

    .app-icon.dragging .app-icon-inner {
        animation: none;
        transform: scale(1.1);
        border-color: #fff;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
        background: rgba(255, 255, 255, 0.1);
    }

    /* UI Elements */
    #desktop-footer {
        position: fixed;
        bottom: 0; left: 0;
        width: 100%;
        height: 40px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85em;
        letter-spacing: 3px;
        text-transform: uppercase;
        color: rgba(0, 255, 255, 0.6);
        z-index: 100;
        border-top: 1px solid rgba(0, 255, 255, 0.1);
    }

    .bottom-button {
        position: fixed;
        bottom: 55px;
        right: 20px;
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(10, 10, 10, 0.85);
        border-radius: 14px;
        border: 1px solid rgba(0, 255, 255, 0.25);
        cursor: pointer;
        transition: all 0.3s;
        z-index: 100;
        font-size: 1.3em;
        backdrop-filter: blur(10px);
    }

    .bottom-button:hover {
        border-color: #0ff;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        transform: translateY(-3px);
    }
    
    #settings-button { right: 80px; }
    
    #settings-menu {
        position: fixed;
        bottom: 115px;
        right: 20px;
        width: 230px;
        background: rgba(5, 5, 5, 0.98);
        border: 1px solid rgba(0, 255, 255, 0.3);
        border-radius: 16px;
        padding: 10px;
        z-index: 150;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.9);
        display: none;
        flex-direction: column;
        gap: 6px;
        backdrop-filter: blur(20px);
    }

    #settings-menu div, #settings-menu label {
        padding: 14px;
        cursor: pointer;
        transition: all 0.2s;
        border-radius: 10px;
        font-size: 14px;
        color: #bbb;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #settings-menu div:hover, #settings-menu label:hover {
        background: rgba(0, 255, 255, 0.15);
        color: #fff;
    }
    
    #bg-upload { display: none; }
  </style>

  <!-- Audio elements -->
  <audio id="bgMusic" loop preload="auto"><source src="wos.mp3" type="audio/mpeg"></audio>
  <audio id="startupSound" preload="auto"><source src="startup.mp3" type="audio/mpeg"></audio>
  <audio id="hoverSound" preload="auto"><source src="menu.mp3" type="audio/mpeg"></audio>
</head>
<body oncontextmenu="return false;">

  <div id="welcome-screen" onclick="bootSystem()">
    <canvas id="welcome-visualizer"></canvas>
    <div id="welcome-content">
      <h1 class="glow">W OS</h1>
      <p style="color: #fff; opacity: 0.5; letter-spacing: 2px;">CLICK TO BOOT</p>
    </div>
  </div>

  <div id="desktop">
    <div class="app-icon" data-name="maze" onclick="openApp(event, 'maze-game.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üéÆ</span>
        <span class="app-label">Maze</span>
      </div>
    </div>
    <div class="app-icon" data-name="platform" onclick="openApp(event, 'platform_game.HTML')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üïπÔ∏è</span>
        <span class="app-label">Platform</span>
      </div>
    </div>
    <div class="app-icon" data-name="ai-chat" onclick="openApp(event, 'smart-chat.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">ü§ñ</span>
        <span class="app-label">AI Chat</span>
      </div>
    </div>
    <div class="app-icon" data-name="translator" onclick="openApp(event, 'wtrandsleter.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üî¢</span>
        <span class="app-label">Translate</span>
      </div>
    </div>
    <div class="app-icon" data-name="space-ranger" onclick="openApp(event, 'space.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üöÄ</span>
        <span class="app-label">Space</span>
      </div>
    </div>
    <div class="app-icon" data-name="tycoon" onclick="openApp(event, 'restraw.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üçú</span>
        <span class="app-label">Tycoon</span>
      </div>
    </div>
    <div class="app-icon" data-name="ball" onclick="openApp(event, 'ball.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üé±</span>
        <span class="app-label">Ball</span>
      </div>
    </div>
    <div class="app-icon" data-name="jelly" onclick="openApp(event, 'jelly.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üçØ</span>
        <span class="app-label">Jelly</span>
      </div>
    </div>
    <div class="app-icon" data-name="only-jump" onclick="openApp(event, 'only jump.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">‚Üë</span>
        <span class="app-label">Jump</span>
      </div>
    </div>
    <div class="app-icon" data-name="snake" onclick="openApp(event, 'snake.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üêç</span>
        <span class="app-label">Snake</span>
      </div>
    </div>
    <div class="app-icon" data-name="fly" onclick="openApp(event, 'fly.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üõ¨</span>
        <span class="app-label">Flight</span>
      </div>
    </div>
    <div class="app-icon" data-name="math" onclick="openApp(event, 'math.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üìä</span>
        <span class="app-label">Education</span>
      </div>
    </div>
    <div class="app-icon" data-name="school-chat" onclick="openApp(event, 'https://chatgpt.com/share/68c13caf-e53c-800a-8cd2-69fbec29f222')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üí¨</span>
        <span class="app-label">Study</span>
      </div>
    </div>
    <div class="app-icon" data-name="lets-chat" onclick="openApp(event, 'https://tlk.io/wos')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üî•</span>
        <span class="app-label">Global Chat</span>
      </div>
    </div>
    <div class="app-icon" data-name="adventure" onclick="openApp(event, 'https://echo3721.itch.io/avendur')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üß≠</span>
        <span class="app-label">Adventure</span>
      </div>
    </div>
    <div class="app-icon" data-name="doge" onclick="openApp(event, 'doge.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üêï</span>
        <span class="app-label">Dodge</span>
      </div>
    </div>
    <div class="app-icon" data-name="cavegame" onclick="openApp(event, 'cave.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">‚õèÔ∏è</span>
        <span class="app-label">Cave</span>
      </div>
    </div>
    <div class="app-icon" data-name="visual" onclick="openApp(event, 'uwu.html')">
      <div class="app-icon-inner">
        <span class="icon-emoji">üåà</span>
        <span class="app-label">Visual</span>
      </div>
    </div>
<div class="app-icon" data-name="fps-shooting" onclick="openApp(event, 'https://vlxp29-3000.csb.app/')">
  <div class="app-icon-inner">
    <span class="icon-emoji">üî´</span>
    <span class="app-label">FPS Shooting</span>
  </div>
</div>
  </div>
  <div id="settings-menu">
    <div onclick="resetAppPositions()">üîÑ Reset Desktop</div>
    <label for="bg-upload">üñºÔ∏è Wallpapers</label>
    <input type="file" id="bg-upload" accept="image/*" onchange="uploadBackground(event)">
  </div>

  <div id="settings-button" class="bottom-button" onclick="toggleSettingsMenu()">‚öôÔ∏è</div>

  <a href="mailto:william.home.z.liu@gmail.com?subject=W OS Feedback">
    <div id="feedback-button" class="bottom-button">üìß</div>
  </a>

  <div id="desktop-footer">W OS // QUANTUM INTERFACE ONLINE</div>

  <script>
    const desktop = document.getElementById('desktop');
    const icons = document.querySelectorAll('.app-icon');
    
    let holdTimer = null;         
    let isDragging = false;       
    let dragElement = null;
    let offsetX, offsetY;
    let wasDragged = false;       
    let hasBooted = false;

    window.onload = function() {
        loadBackground();
    };

    function openApp(event, url) {
        if (wasDragged) {
            wasDragged = false; 
            return;
        }
        window.open(url, '_blank');
    }

    function bootSystem() {
      if (hasBooted) return;
      hasBooted = true;

      const bgMusic = document.getElementById('bgMusic');
      const startupSound = document.getElementById('startupSound');
      const welcome = document.getElementById('welcome-screen');
      
      // Play startup sound effect
      startupSound.play().catch(e => console.log("Startup audio blocked:", e));
      
      // Play loop music 
      bgMusic.play().catch(e => console.log("BG audio blocked:", e));
      
      // Animation transition
      welcome.classList.add('fade-out');
      setTimeout(() => {
        welcome.style.display = 'none';
        loadIconPositions();
      }, 1000);

      // Stop the visualizer animation loop
      if (animFrameId) cancelAnimationFrame(animFrameId);
    }

    icons.forEach(icon => {
      icon.addEventListener('mouseenter', () => {
        const hoverSound = document.getElementById('hoverSound');
        hoverSound.currentTime = 0;
        hoverSound.play().catch(() => {});
      });
    });

    const canvas = document.getElementById('welcome-visualizer');
    const ctx = canvas.getContext('2d');
    let time = 0;
    let animFrameId;

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawVisualizer() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        time += 0.01;
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, `hsl(${Math.sin(time * 0.5) * 20 + 200}, 80%, 10%)`);
        gradient.addColorStop(1, `hsl(${Math.cos(time * 0.7) * 20 + 260}, 80%, 5%)`);
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        animFrameId = requestAnimationFrame(drawVisualizer);
    }
    drawVisualizer();

    function dragStart(e) {
      if (e.button !== 0) return; 

      const targetIcon = e.target.closest('.app-icon');
      if (!targetIcon) return;

      dragElement = targetIcon;
      const rect = dragElement.getBoundingClientRect();
      
      offsetX = e.clientX - rect.left;
      offsetY = e.clientY - rect.top;

      holdTimer = setTimeout(() => {
          isDragging = true;
          wasDragged = true;
          dragElement.classList.add('dragging');
          dragElement.style.position = 'fixed';
          moveIcon(e.clientX, e.clientY);
      }, 250); 
    }

    function moveIcon(x, y) {
      if (!dragElement) return;
      dragElement.style.left = (x - offsetX) + 'px';
      dragElement.style.top = (y - offsetY) + 'px';
    }

    function dragMove(e) {
      if (isDragging) {
        moveIcon(e.clientX, e.clientY);
      }
    }

    function dragEnd() {
      clearTimeout(holdTimer);
      if (isDragging) {
        isDragging = false;
        dragElement.classList.remove('dragging');
        saveIconPositions();
      }
      dragElement = null;
    }

    desktop.addEventListener('mousedown', dragStart);
    window.addEventListener('mousemove', dragMove);
    window.addEventListener('mouseup', dragEnd);

    function saveIconPositions() {
      const positions = {};
      icons.forEach(icon => {
        if (icon.style.left) {
          positions[icon.dataset.name] = {
            left: icon.style.left,
            top: icon.style.top
          };
        }
      });
      localStorage.setItem('wos_icon_positions_v3', JSON.stringify(positions));
    }

    function loadIconPositions() {
      const positions = JSON.parse(localStorage.getItem('wos_icon_positions_v3'));
      if (positions) {
        icons.forEach(icon => {
          const data = positions[icon.dataset.name];
          if (data) {
            icon.style.position = 'fixed';
            icon.style.left = data.left;
            icon.style.top = data.top;
          }
        });
      }
    }

    function uploadBackground(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const url = e.target.result;
                document.body.style.backgroundImage = `url(${url})`;
                localStorage.setItem('wos_background_image', url);
            };
            reader.readAsDataURL(file);
        }
        toggleSettingsMenu();
    }

    function loadBackground() {
        const saved = localStorage.getItem('wos_background_image');
        if (saved) document.body.style.backgroundImage = `url(${saved})`;
    }

    function toggleSettingsMenu() {
        const menu = document.getElementById('settings-menu');
        menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
    }

    function resetAppPositions() {
        icons.forEach(icon => {
            icon.style.position = '';
            icon.style.left = '';
            icon.style.top = '';
        });
        document.body.style.backgroundImage = "url('gb.png')";
        localStorage.removeItem('wos_icon_positions_v3');
        localStorage.removeItem('wos_background_image');
        toggleSettingsMenu();
    }
  </script>
  <script>
    // Function to mute all media elements (audio and video)
    function muteAllMedia() {
        document.querySelectorAll('audio, video').forEach(mediaElement => {
            // Store the original volume if needed, but 'muted = true' is simpler
            mediaElement.muted = true;
            // You can also pause if desired
            // mediaElement.pause();
        });
        console.log('Tab inactive: Muted all media.');
    }

    // Function to unmute all media elements
    function unmuteAllMedia() {
        document.querySelectorAll('audio, video').forEach(mediaElement => {
            mediaElement.muted = false;
            // If you paused, you might try to play, but user interaction rules may block autoplay
            // mediaElement.play(); 
        });
        console.log('Tab active: Unmuted all media.');
    }

    // Listen for the visibilitychange event
    document.addEventListener("visibilitychange", function() {
        if (document.visibilityState === "hidden") {
            // Tab is inactive/hidden
            muteAllMedia();
        } else {
            // Tab is active/visible
            unmuteAllMedia();
        }
    });
</script>
</body>
</html>
